{"version":3,"sources":["../../src/EarthObject.js"],"names":[],"mappings":"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","file":"EarthObject.js","sourcesContent":["\nimport * as Loaders from './Loaders.js';\nimport Tweet from './Tweet.js';\n\nvar raycaster = new THREE.Raycaster();\n\nvar mouse = new THREE.Vector2();\n\ndocument.body.addEventListener( 'mousemove', onMouseMove, false );\n\nvar leftSide = document.getElementById(\"leftSide\");\nvar rightSide = document.getElementById(\"rightSide\");\n\nvar onCanvas = false;\nfunction onMouseMove( event ) {\n\n  onCanvas = event.target.id == \"earth\";\n\n  // calculate mouse position in normalized device coordinates\n  // (-1 to +1) for both components\n\n  mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;\n  mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;   \n\n}\n\n\nexport default class EarthObject extends THREE.Object3D {\n  constructor() {\n    super();\n\n\n    Loaders.Texture('images/elev_bump_4k.jpg').generateMipmaps = true;\n\n    this.globeMesh = new THREE.Mesh(\n      new THREE.SphereGeometry(10, 50, 50),\n      new THREE.MeshPhongMaterial({\n        map: Loaders.Texture('images/2_no_clouds_4k.jpg'),\n        bumpMap: Loaders.Texture('images/earthbump.png'),\n        bumpScale: 0.3,\n        // normalMap: Loaders.Texture('images/earth_normal.png'),\n        // normalScale: new THREE.Vector2(0.3,0.3),\n        specularMap: Loaders.Texture('images/water_4k.png'),\n        specular: new THREE.Color('grey'),\n        // wireframe: true\n      })\n    );\n    this.add(this.globeMesh);\n    this.globeMesh.rotation.x = Math.PI/2;\n\n    this.cloudMesh = new THREE.Mesh(\n\n      new THREE.SphereGeometry(10.1, 50, 50),\n      new THREE.MeshBasicMaterial({\n        map: Loaders.Texture('images/Earth-clouds-1.png'),\n        transparent: true\n      })\n\n    );\n    this.add(this.cloudMesh);\n\n    this.cloudMesh.rotation.x = Math.PI/2;\n    this.beacons = [];\n\n    // todo: destroy these event listeners...\n\n    window.addEventListener( 'click', (e) => {\n      if (e.target.id == \"earth\") {\n        if (this.lastIntersect) {\n          this.lastIntersect.object.parent.parent.onClick();\n        }\n      }\n    });\n\n    controls.addEventListener('change', function() {\n      if (controls.locking) {\n        return;\n      }\n\n      leftSide.className = \"inside\";\n      rightSide.className = \"inside\";\n    });\n\n  }\n\n  addEvent(event) {\n    var tweet = new Tweet({message: event.title, tweets: event.twitter});\n    var geo = event.geometries[0];\n\n    var pos;\n    if (geo.type == \"Point\") {\n      pos = event.geometries[0].coordinates;\n    } else {\n      pos = event.geometries[0].coordinates[0][0];\n    }\n\n    tweet.position.copy(this.latLongAltToPoint(pos[1],pos[0], 10));\n    this.add(tweet);\n\n    this.beacons.push(tweet);\n  }\n\n  update() {\n    // var i = 0;\n    // for (var coord of this.positions) {\n    //   var pos = this.latLongAltToPoint(coord[0], coord[1], coord[2]);\n\n    //   this.cubes[i].position.copy(pos);\n    //   i++;\n\n    // }\n    // console.log(\"yo\")\n\n    raycaster.setFromCamera( mouse, camera ); \n\n    if (onCanvas) {\n      // calculate objects intersecting the picking ray\n      var mesh = [];\n      for (var i in this.beacons) {\n        mesh.push(this.beacons[i].beacon.mesh);\n      }\n\n      var intersects = raycaster.intersectObjects( mesh );\n\n      if (intersects[0] != this.lastIntersect && this.lastIntersect) {\n        this.lastIntersect.object.parent.parent.stopHover();\n      };\n\n      if (intersects[0] && intersects[0] != this.lastIntersect) {\n        intersects[0].object.parent.parent.startHover();\n      }\n      this.lastIntersect = intersects[0];\n    }\n\n    this.cloudMesh.rotation.y += deltaTime/10000;\n\n    var opacity = camera.position.length() / 15 - 1;\n\n    if (opacity < 0) {\n      opacity = 0;\n    }\n\n    if (opacity > 1) {\n      opacity = 1;\n    }\n\n    this.cloudMesh.material.opacity = opacity;\n  }\n\n  sinTest() {\n    return (Math.sin((new Date()).getTime()/100)+1)/2;\n  }\n\n  latLongAltToPoint(lat, long, rho) {\n    var phi = lat * Math.PI/180;// + this.sinTest()*Math.PI/2;\n    // var phi = long * Math.PI/180;\n    var theta = long * Math.PI/180 + Math.PI;\n    var x = Math.cos(phi) * Math.cos(theta) * -rho;\n    var y = Math.cos(phi) * Math.sin(theta) * -rho;\n    var z = Math.sin(phi) * rho;\n    return new THREE.Vector3(x, y, z);\n  }\n}\n"]}